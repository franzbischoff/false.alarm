<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Materials and methods | Detecting life-threatening patterns in Point-of-care ECG using efficient memory and processor power</title>
  <meta name="description" content="This thesis is about low-power devices and ECG" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Materials and methods | Detecting life-threatening patterns in Point-of-care ECG using efficient memory and processor power" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://franzbischoff.github.io/false.alarm/thesis/" />
  <meta property="og:image" content="https://franzbischoff.github.io/false.alarm/thesis//figure/FullSetup.jpg" />
  <meta property="og:description" content="This thesis is about low-power devices and ECG" />
  <meta name="github-repo" content="franzbischoff/false.alarm" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Materials and methods | Detecting life-threatening patterns in Point-of-care ECG using efficient memory and processor power" />
  
  <meta name="twitter:description" content="This thesis is about low-power devices and ECG" />
  <meta name="twitter:image" content="https://franzbischoff.github.io/false.alarm/thesis//figure/FullSetup.jpg" />

<meta name="author" content="Francisco Bischoff" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="favicon.ico" />
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link rel="prev" href="principles.html"/>
<link rel="next" href="current-results.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />




<link rel="stylesheet" href="css/style.css" type="text/css" />
<link rel="stylesheet" href="css/toc.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li>
  <a href='https://franzbischoff.github.io/false.alarm/'>Back to the workflow</a>
</li>

<li class="divider"></li>
<li><a href="introduction.html#introduction">Introduction<span></span></a></li>
<li class="chapter" data-level="1" data-path="objectives-and-the-research-question.html"><a href="objectives-and-the-research-question.html"><i class="fa fa-check"></i><b>1</b> Objectives and the research question<span></span></a></li>
<li class="chapter" data-level="2" data-path="principles.html"><a href="principles.html"><i class="fa fa-check"></i><b>2</b> Principles<span></span></a></li>
<li class="chapter" data-level="3" data-path="materials-and-methods.html"><a href="materials-and-methods.html"><i class="fa fa-check"></i><b>3</b> Materials and methods<span></span></a><ul>
<li class="chapter" data-level="3.1" data-path="materials-and-methods.html"><a href="materials-and-methods.html#softwares"><i class="fa fa-check"></i><b>3.1</b> Softwares<span></span></a><ul>
<li class="chapter" data-level="3.1.1" data-path="materials-and-methods.html"><a href="materials-and-methods.html#pipeline-management"><i class="fa fa-check"></i><b>3.1.1</b> Pipeline management<span></span></a></li>
<li class="chapter" data-level="3.1.2" data-path="materials-and-methods.html"><a href="materials-and-methods.html#reports-management"><i class="fa fa-check"></i><b>3.1.2</b> Reports management<span></span></a></li>
<li class="chapter" data-level="3.1.3" data-path="materials-and-methods.html"><a href="materials-and-methods.html#modeling-and-parameter-tuning"><i class="fa fa-check"></i><b>3.1.3</b> Modeling and parameter tuning<span></span></a></li>
<li class="chapter" data-level="3.1.4" data-path="materials-and-methods.html"><a href="materials-and-methods.html#continuous-integration"><i class="fa fa-check"></i><b>3.1.4</b> Continuous integration<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="materials-and-methods.html"><a href="materials-and-methods.html#developed-software"><i class="fa fa-check"></i><b>3.2</b> Developed software<span></span></a><ul>
<li class="chapter" data-level="3.2.1" data-path="materials-and-methods.html"><a href="materials-and-methods.html#matrixprofile"><i class="fa fa-check"></i><b>3.2.1</b> Matrix Profile<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="materials-and-methods.html"><a href="materials-and-methods.html#the-data"><i class="fa fa-check"></i><b>3.3</b> The data<span></span></a></li>
<li class="chapter" data-level="3.4" data-path="materials-and-methods.html"><a href="materials-and-methods.html#work-structure"><i class="fa fa-check"></i><b>3.4</b> Work structure<span></span></a><ul>
<li class="chapter" data-level="3.4.1" data-path="materials-and-methods.html"><a href="materials-and-methods.html#project-start"><i class="fa fa-check"></i><b>3.4.1</b> Project start<span></span></a></li>
<li class="chapter" data-level="3.4.2" data-path="materials-and-methods.html"><a href="materials-and-methods.html#raw-data"><i class="fa fa-check"></i><b>3.4.2</b> RAW data<span></span></a></li>
<li class="chapter" data-level="3.4.3" data-path="materials-and-methods.html"><a href="materials-and-methods.html#preparing-the-data"><i class="fa fa-check"></i><b>3.4.3</b> Preparing the data<span></span></a></li>
<li class="chapter" data-level="3.4.4" data-path="materials-and-methods.html"><a href="materials-and-methods.html#detecting-regime-changes"><i class="fa fa-check"></i><b>3.4.4</b> Detecting regime changes<span></span></a></li>
<li class="chapter" data-level="3.4.5" data-path="materials-and-methods.html"><a href="materials-and-methods.html#classregime"><i class="fa fa-check"></i><b>3.4.5</b> Classification of the new regime<span></span></a></li>
<li class="chapter" data-level="3.4.6" data-path="materials-and-methods.html"><a href="materials-and-methods.html#summary-of-the-methodology"><i class="fa fa-check"></i><b>3.4.6</b> Summary of the methodology<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="materials-and-methods.html"><a href="materials-and-methods.html#evaluation"><i class="fa fa-check"></i><b>3.5</b> Evaluation of the algorithms<span></span></a><ul>
<li class="chapter" data-level="3.5.1" data-path="materials-and-methods.html"><a href="materials-and-methods.html#regime-change"><i class="fa fa-check"></i><b>3.5.1</b> Regime change<span></span></a></li>
<li class="chapter" data-level="3.5.2" data-path="materials-and-methods.html"><a href="materials-and-methods.html#classification"><i class="fa fa-check"></i><b>3.5.2</b> Classification<span></span></a></li>
<li class="chapter" data-level="3.5.3" data-path="materials-and-methods.html"><a href="materials-and-methods.html#full-model-streaming-setting"><i class="fa fa-check"></i><b>3.5.3</b> Full model (streaming setting)<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="current-results.html"><a href="current-results.html"><i class="fa fa-check"></i><b>4</b> Current results<span></span></a><ul>
<li class="chapter" data-level="4.1" data-path="current-results.html"><a href="current-results.html#regime-change-detection"><i class="fa fa-check"></i><b>4.1</b> Regime change detection<span></span></a></li>
<li class="chapter" data-level="4.2" data-path="current-results.html"><a href="current-results.html#classification-1"><i class="fa fa-check"></i><b>4.2</b> Classification<span></span></a></li>
<li class="chapter" data-level="4.3" data-path="current-results.html"><a href="current-results.html#feasibility-trial"><i class="fa fa-check"></i><b>4.3</b> Feasibility trial<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="scientific-contributions.html"><a href="scientific-contributions.html"><i class="fa fa-check"></i><b>5</b> Scientific contributions<span></span></a><ul>
<li class="chapter" data-level="5.1" data-path="scientific-contributions.html"><a href="scientific-contributions.html#matrix-profile"><i class="fa fa-check"></i><b>5.1</b> Matrix Profile<span></span></a></li>
<li class="chapter" data-level="5.2" data-path="scientific-contributions.html"><a href="scientific-contributions.html#regime-change-detection-1"><i class="fa fa-check"></i><b>5.2</b> Regime change detection<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="scientific-outcomes.html"><a href="scientific-outcomes.html"><i class="fa fa-check"></i><b>6</b> Scientific outcomes<span></span></a></li>
<li><a href="conclusion.html#conclusion">Conclusion<span></span></a></li>
<li class="appendix"><span><b>Appendix<span></span></b></span></li>
<li class="chapter" data-level="A" data-path="the-first-appendix.html"><a href="the-first-appendix.html"><i class="fa fa-check"></i><b>A</b> The First Appendix<span></span></a></li>
<li class="chapter" data-level="B" data-path="the-second-appendix-for-fun.html"><a href="the-second-appendix-for-fun.html"><i class="fa fa-check"></i><b>B</b> The Second Appendix, for Fun<span></span></a></li>
<li><a href="references.html#references">References<span></span></a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Detecting life-threatening patterns in Point-of-care ECG using efficient memory and processor power</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="materials-and-methods" class="section level1 hasAnchor">
<h1><span class="header-section-number">3</span> Materials and methods<a href="materials-and-methods.html#materials-and-methods" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="softwares" class="section level2 hasAnchor">
<h2><span class="header-section-number">3.1</span> Softwares<a href="materials-and-methods.html#softwares" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="pipeline-management" class="section level3 hasAnchor">
<h3><span class="header-section-number">3.1.1</span> Pipeline management<a href="materials-and-methods.html#pipeline-management" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>All steps of the process are being managed using the R package <code>targets</code><span class="citation"><sup><a href="references.html#ref-landau2021" role="doc-biblioref">13</a></sup></span> from data
extraction to the final report. An example of a pipeline visualization created with <code>targets</code> is
shown in Fig. <a href="materials-and-methods.html#fig:targets">3.1</a>. This package helps to keep record of the random seeds (allowing
reproducibility), changes in some part of the code (or dependencies) and then running only the
branches that need to be updated, and several other features to keep a reproducible workflow
avoiding unnecessary repetitions.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:targets"></span>
<img src="/home/runner/work/false.alarm/false.alarm/protocol/figure/targets.svg" alt="Example of pipeline visualization using `targets`. From left to right we see 'Stems' (steps that do not create branches) and 'Patterns' (that contains two or more branches) and the flow of the information. The green color means that the step is up to date to the current code and dependencies." width="100%" />
<p class="caption">
FIGURE 3.1: Example of pipeline visualization using <code>targets</code>. From left to right we see ‘Stems’ (steps that do not create branches) and ‘Patterns’ (that contains two or more branches) and the flow of the information. The green color means that the step is up to date to the current code and dependencies.
</p>
</div>
</div>
<div id="reports-management" class="section level3 hasAnchor">
<h3><span class="header-section-number">3.1.2</span> Reports management<a href="materials-and-methods.html#reports-management" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The report is available on the main webpage,<span class="citation"><sup><a href="references.html#ref-franz_website" role="doc-biblioref">14</a></sup></span> allowing inspection of previous
versions managed by the R package <code>workflowr</code><span class="citation"><sup><a href="references.html#ref-workflowr2021" role="doc-biblioref">15</a></sup></span>. This package complements the
<code>targets</code> package by taking care of the versioning of every report. It is like a Log Book that keeps
track of every important milestone of the project, while summarize the computational environment
where it was run. Fig. <a href="materials-and-methods.html#fig:workflowr">3.2</a> shows only a fraction of the generated website, where we
can see that this version passed the required checks (system is up-to-date, no caches, session
information was recorded, and others) and we see a table of previous versions.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:workflowr"></span>
<img src="/home/runner/work/false.alarm/false.alarm/protocol/figure/workflowr_print.png" alt="Fraction of the website generated by `workflowr`. On top we see that this version passed all checks, and in the middle we see a table referring to the previous versions of the report.." width="100%" />
<p class="caption">
FIGURE 3.2: Fraction of the website generated by <code>workflowr</code>. On top we see that this version passed all checks, and in the middle we see a table referring to the previous versions of the report..
</p>
</div>
</div>
<div id="modeling-and-parameter-tuning" class="section level3 hasAnchor">
<h3><span class="header-section-number">3.1.3</span> Modeling and parameter tuning<a href="materials-and-methods.html#modeling-and-parameter-tuning" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The well known package used for data science in R is the <code>caret</code> (short for <strong>C</strong>lassification
<strong>A</strong>nd <strong>RE</strong>gression <strong>T</strong>raining).<span class="citation"><sup><a href="references.html#ref-JSSv028i05" role="doc-biblioref">16</a></sup></span> Nevertheless, the author of <code>caret</code> recognizes
several limitations of his (great) package, and is now in charge of the development of the
<code>tidymodels</code><span class="citation"><sup><a href="references.html#ref-tidymodels2020" role="doc-biblioref">17</a></sup></span> collection. For sure, there are other available frameworks and
opinions.<span class="citation"><sup><a href="references.html#ref-Thompson2020" role="doc-biblioref">18</a></sup></span> Notwithstanding, this project will follow the <code>tidymodels</code> road. Three
significant arguments 1) constantly improving and constantly being re-checked for bugs; large
community contribution; 2) allows to plug in a custom modeling algorithm that, in this case, will be
the one needed for developing this work; 3) <code>caret</code> is not in active development.</p>
</div>
<div id="continuous-integration" class="section level3 hasAnchor">
<h3><span class="header-section-number">3.1.4</span> Continuous integration<a href="materials-and-methods.html#continuous-integration" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Meanwhile, the project pipeline has been set up on GitHub, Inc. <span class="citation"><sup><a href="references.html#ref-bischoffrepo2021" role="doc-biblioref">19</a></sup></span> leveraging on
Github Actions<span class="citation"><sup><a href="references.html#ref-gitactions2021" role="doc-biblioref">20</a></sup></span> for the Continuous Integration lifecycle. The repository is
available at,<span class="citation"><sup><a href="references.html#ref-bischoffrepo2021" role="doc-biblioref">19</a></sup></span> and the resulting report is available at.<span class="citation"><sup><a href="references.html#ref-franz_website" role="doc-biblioref">14</a></sup></span>
It is also public available the roadmap and tasks status of this thesis on Zenhub.<span class="citation"><sup><a href="references.html#ref-zenhub2021" role="doc-biblioref">21</a></sup></span></p>
</div>
</div>
<div id="developed-software" class="section level2 hasAnchor">
<h2><span class="header-section-number">3.2</span> Developed software<a href="materials-and-methods.html#developed-software" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="matrixprofile" class="section level3 hasAnchor">
<h3><span class="header-section-number">3.2.1</span> Matrix Profile<a href="materials-and-methods.html#matrixprofile" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Matrix Profile (MP),<span class="citation"><sup><a href="references.html#ref-Yeh2017a" role="doc-biblioref">22</a></sup></span> is a state-of-the-art<span class="citation"><sup><a href="references.html#ref-DePaepe2020" role="doc-biblioref">23</a>,<a href="references.html#ref-Feremans2020" role="doc-biblioref">24</a></sup></span> time series
analysis technique that once computed, allows us to derive frameworks to all sorts of tasks, as
motif discovery, anomaly detection, regime change detection and others.<span class="citation"><sup><a href="references.html#ref-Yeh2017a" role="doc-biblioref">22</a></sup></span></p>
<p>Before MP, time series analysis relied on what is called <em>distance matrix</em> (DM), a matrix that stores all
the distances between two time series (or itself, in case of a Self-Join). This was very power consuming,
and several methods of pruning and dimensionality reduction were researched.<span class="citation"><sup><a href="references.html#ref-Lin2007" role="doc-biblioref">25</a></sup></span></p>
<p>For brevity, let’s just understand that the MP and the companion Profile Index (PI) are two vectors
that hold one floating point value and one integer value, respectively, regarding the original time
series: (1) the similarity distance between that point on time (let’s call these points “indexes”)
and its first nearest-neighbor (1-NN), (2) The index where this this 1-NN is located. The original
paper has more detailed information.<span class="citation"><sup><a href="references.html#ref-Yeh2017a" role="doc-biblioref">22</a></sup></span> It is computed using a rolling window but instead
of creating a whole DM, only the minimum values and the index of these minimum are stored (in the
MP and PI respectively). We can have an idea of the relationship of both on Fig. <a href="materials-and-methods.html#fig:thematrix">3.3</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:thematrix"></span>
<img src="/home/runner/work/false.alarm/false.alarm/protocol/figure/mp_1.png" alt="A distance matrix (top), and a matrix profile (bottom). The matrix profile stores only the minimum values of the distance matrix." width="178" />
<p class="caption">
FIGURE 3.3: A distance matrix (top), and a matrix profile (bottom). The matrix profile stores only the minimum values of the distance matrix.
</p>
</div>
<p>This research has already yielded two R packages concerning the MP algorithms from UCR.<span class="citation"><sup><a href="references.html#ref-mpucr" role="doc-biblioref">26</a></sup></span> The
first package is called <code>tsmp</code>, and a paper has also been published in the R Journal<span class="citation"><sup><a href="references.html#ref-RJ-2020-021" role="doc-biblioref">27</a></sup></span>
(Journal Impact Factor™, 2020 of 3.984). The second package is called <code>matrixprofiler</code> and enhances
the first one, using low-level language to improve computational speed. The author has also joined
the Matrix Profile Foundation as co-founder together with contributors from Python and Go languages.<span class="citation"><sup><a href="references.html#ref-mpf2020" role="doc-biblioref">28</a>,<a href="references.html#ref-VanBenschoten2020" role="doc-biblioref">29</a></sup></span></p>
<p>This implementation in R is being used for computing the MP and MP-based algorithms of this thesis.</p>
</div>
</div>
<div id="the-data" class="section level2 hasAnchor">
<h2><span class="header-section-number">3.3</span> The data<a href="materials-and-methods.html#the-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The current dataset used is the CinC/Physionet Challenge 2015 public dataset, modified to include
only the actual data and the header files in order to be read by the pipeline and is hosted by
Zenodo<span class="citation"><sup><a href="references.html#ref-bischoff2021" role="doc-biblioref">30</a></sup></span> under the same license as Physionet.</p>
<p>The dataset is composed of 750 patients with at least five minutes records. All signals have been
resampled (using anti-alias filters) to 12 bit, 250 Hz and have had FIR band-pass (0.05 to 40Hz) and
mains notch filters applied to remove noise. Pacemaker and other artifacts are still present on the
ECG.<span class="citation"><sup><a href="references.html#ref-Clifford2015" role="doc-biblioref">6</a></sup></span> Furthermore, this dataset contains at least two ECG derivations and one or more
variables like arterial blood pressure, photoplethysmograph readings, and respiration movements.</p>
<p>The <em>events</em> we seek to identify are the life-threatening arrhythmias as defined by Physionet in
Table <a href="materials-and-methods.html#tab:alarms">3.1</a>.</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:alarms">TABLE 3.1: </span>Definition of the five alarm types used in CinC/Physionet Challenge 2015.
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;">
Alarm
</th>
<th style="text-align:left;font-weight: bold;">
Definition
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Asystole
</td>
<td style="text-align:left;">
No QRS for at least 4 seconds
</td>
</tr>
<tr>
<td style="text-align:left;">
Extreme Bradycardia
</td>
<td style="text-align:left;">
Heart rate lower than 40 bpm for 5 consecutive beats
</td>
</tr>
<tr>
<td style="text-align:left;">
Extreme Tachycardia
</td>
<td style="text-align:left;">
Heart rate higher than 140 bpm for 17 consecutive beats
</td>
</tr>
<tr>
<td style="text-align:left;">
Ventricular Tachycardia
</td>
<td style="text-align:left;">
5 or more ventricular beats with heart rate higher than 100 bpm
</td>
</tr>
<tr>
<td style="text-align:left;">
Ventricular Flutter/Fibrillation
</td>
<td style="text-align:left;">
Fibrillatory, flutter, or oscillatory waveform for at least 4 seconds
</td>
</tr>
</tbody>
</table>
<p>The fifth minute is precisely where the alarm has been triggered on the original recording set. To
meet the ANSI/AAMI EC13 Cardiac Monitor Standards,<span class="citation"><sup><a href="references.html#ref-AAMI2002" role="doc-biblioref">31</a></sup></span> the onset of the event is within 10
seconds of the alarm (i.e., between 4:50 and 5:00 of the record). That doesn’t mean that there are
no other arrhythmias before.</p>
<p>For comparison, on Table <a href="materials-and-methods.html#tab:challenge">3.2</a> we collected the score of the five best participants
of the challenge.<span class="citation"><sup><a href="references.html#ref-plesinger2015" role="doc-biblioref">32</a>–<a href="references.html#ref-hoogantink2015" role="doc-biblioref">36</a></sup></span></p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:challenge">TABLE 3.2: </span>Challenge Results on real-time data. The scores were multiplied by 100.
</caption>
<thead>
<tr>
<th style="text-align:center;font-weight: bold;">
Score
</th>
<th style="text-align:left;font-weight: bold;">
Authors
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
81.39
</td>
<td style="text-align:left;">
Filip Plesinger, Petr Klimes, Josef Halamek, Pavel Jurak
</td>
</tr>
<tr>
<td style="text-align:center;">
79.44
</td>
<td style="text-align:left;">
Vignesh Kalidas
</td>
</tr>
<tr>
<td style="text-align:center;">
79.02
</td>
<td style="text-align:left;">
Paula Couto, Ruben Ramalho, Rui Rodrigues
</td>
</tr>
<tr>
<td style="text-align:center;">
76.11
</td>
<td style="text-align:left;">
Sibylle Fallet, Sasan Yazdani, Jean-Marc Vesin
</td>
</tr>
<tr>
<td style="text-align:center;">
75.55
</td>
<td style="text-align:left;">
Christoph Hoog Antink, Steffen Leonhardt
</td>
</tr>
</tbody>
</table>
<p>The equation used on this challenge to compute the score of the algorithms is in the Equation
<a href="materials-and-methods.html#eq:score">(3.1)</a>. This equation is the accuracy formula, with penalization of the false negatives.
The reasoning pointed out by the authors<span class="citation"><sup><a href="references.html#ref-Clifford2015" role="doc-biblioref">6</a></sup></span> is the clinical impact of existing a
genuine life-threatening event that was considered unimportant. Accuracy is known to be misleading
when there is a high class imbalance.<span class="citation"><sup><a href="references.html#ref-Akosa2017" role="doc-biblioref">37</a></sup></span></p>
<p><br />
<span class="math display" id="eq:score">\[\begin{equation}
Score = \frac{TP+TN}{TP+TN+FP+5*FN}  \tag{3.1}
\end{equation}\]</span><br />
</p>
<p>Assuming that this is a finite dataset, the pathologic cases (1) <span class="math inline">\(\lim_{TP \to \infty}\)</span> (whenever
there is an event, it is positive) or (2) <span class="math inline">\(\lim_{TN \to \infty}\)</span> (whenever there is an event, it is
false), cannot happen. This dataset has 292 True alarms and 458 False alarms. Experimentally, this
equation yields:</p>
<ul>
<li>0.24 if all guesses are on False class
<ul>
<li>0.28 if random guesses</li>
<li>0.39 if all guesses are on True class</li>
<li>0.45 if no false positives plus random on True class</li>
<li>0.69 if no false negatives plus random on False class</li>
</ul></li>
</ul>
<p>This small experiment (knowing the data in advance) shows that “a single line of code and a few
minutes of effort”<span class="citation"><sup><a href="references.html#ref-Wu2020" role="doc-biblioref">38</a></sup></span> algorithm could achieve at most a score of 0.39 in this challenge (the
last two lines, the algorithm must to be very good on one class).</p>
<p>Nevertheless, this equation will only be useful to allow us to compare the results of this thesis
with other algorithms.</p>
</div>
<div id="work-structure" class="section level2 hasAnchor">
<h2><span class="header-section-number">3.4</span> Work structure<a href="materials-and-methods.html#work-structure" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="project-start" class="section level3 hasAnchor">
<h3><span class="header-section-number">3.4.1</span> Project start<a href="materials-and-methods.html#project-start" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The project started with a literature survey on the databases Scopus, PubMed, Web of Science, and
Google Scholar with the following query (the syntax was adapted for each database):</p>
<p><br />
TITLE-ABS-KEY ( algorithm OR ‘point of care’ OR ‘signal processing’ OR ‘computer
assisted’ OR ‘support vector machine’ OR ‘decision support system<em>’ OR ’neural
network</em>’ OR ‘automatic interpretation’ OR ‘machine learning’) AND TITLE-ABS-KEY
( electrocardiography OR cardiography OR ‘electrocardiographic tracing’ OR ecg
OR electrocardiogram OR cardiogram ) AND TITLE-ABS-KEY ( ‘Intensive care unit’ OR
‘cardiologic care unit’ OR ‘intensive care center’ OR ‘cardiologic care center’ )<br />
</p>
<p>The inclusion and exclusion criteria were defined as in Table <a href="materials-and-methods.html#tab:criteria">3.3</a>.</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:criteria">TABLE 3.3: </span>Literature review criteria.
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;">
Inclusion criteria
</th>
<th style="text-align:left;font-weight: bold;">
Exclusion criteria
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
ECG automatic interpretation
</td>
<td style="text-align:left;">
Manual interpretation
</td>
</tr>
<tr>
<td style="text-align:left;">
ECG anomaly detection
</td>
<td style="text-align:left;">
Publication older than ten years
</td>
</tr>
<tr>
<td style="text-align:left;">
ECG context change detection
</td>
<td style="text-align:left;">
Do not attempt to identify life-threatening arrhythmias, namely asystole, extreme bradycardia, extreme tachycardia, ventricular tachycardia, and ventricular flutter/fibrillation
</td>
</tr>
<tr>
<td style="text-align:left;">
Online Stream ECG analysis
</td>
<td style="text-align:left;">
No performance measurements reported
</td>
</tr>
<tr>
<td style="text-align:left;">
Specific diagnosis (like a flutter, hyperkalemia, etc.)
</td>
<td style="text-align:left;">
</td>
</tr>
</tbody>
</table>
<p>The survey is being conducted with peer review, all articles on full-text phase were obtained and
assessed for the extraction phase, with exception of 5 articles that were not available. The survey
is currently staled on the Data Extraction phase due to external factors.</p>
<p>Fig. <a href="materials-and-methods.html#fig:prisma">3.4</a> shows the flow diagram of the resulting screening using PRISMA format.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:prisma"></span>
<img src="/home/runner/work/false.alarm/false.alarm/protocol/figure/PRISMA.png" alt="Flowchart of the literature survey." width="70%" />
<p class="caption">
FIGURE 3.4: Flowchart of the literature survey.
</p>
</div>
<p>The peer review is being conducted by the author of this thesis together with another coleague, Dr.
Andrew Van Benschoten from the Matrix Profile Foundation.<span class="citation"><sup><a href="references.html#ref-mpf2020" role="doc-biblioref">28</a></sup></span></p>
<p>Table. <a href="#tab:kappa">3.4</a> shows the Inter-rater Reliability (IRR) of the screening phases, using Cohen’s <span class="math inline">\(\kappa\)</span> statistic.
The bottom line shows the estimated accuracy after corrected for possible confounders.<span class="citation"><sup><a href="references.html#ref-Bakeman2011" role="doc-biblioref">39</a></sup></span></p>
<div class="figure" style="text-align: center">
<img src="/home/runner/work/false.alarm/false.alarm/protocol/figure/kappa.svg" alt="Inter-rater Reliability on the literature survey process."  />
<p class="caption">
(#tab:kappa)Inter-rater Reliability on the literature survey process.
</p>
</div>
<p><br />
</p>
<p>The purpose of using Cohen’s <span class="math inline">\(\kappa\)</span> in such review is to allow us to gauge the agreement of both
reviewers on the task of selecting the articles according to the goal of the survey. The most naive
way to verify this would be simply to measure the overall agreement (the number of articles included
and excluded by both, divided by the total number of articles). Nevertheless, this would not take
into account the agreement we could expect purely by chance.</p>
<p>However, the <span class="math inline">\(\kappa\)</span> statistic must be assessed carefully. This topic is beyond the scope of this work
therefore it will be explained briefly.</p>
<p>While it is widely used, the <span class="math inline">\(\kappa\)</span> statistic is also well criticized. The direct interpretation of
its value depends on several assumptions that are often violated. (1) It is assumed that both
reviewers have the same level of experience; (2) The “codes” (include, exclude) are identified with
same accuracy; (3) The “codes” prevalence are the same; (4) There is no reviewer bias towards one of
the choices.<span class="citation"><sup><a href="references.html#ref-Sim2005" role="doc-biblioref">40</a>,<a href="references.html#ref-Bakeman1997" role="doc-biblioref">41</a></sup></span></p>
<p>In addition, the number of “codes” affects the relation between the value of <span class="math inline">\(\kappa\)</span> and the actual
agreement between the reviewers. For example, given equiprobable “codes” and reviewers who are 85%
accurate, the value of <span class="math inline">\(\kappa\)</span> are 0.49, 0.60, 0.66, and 0.69 when number of codes is 2, 3, 5, and 10,
respectively.<span class="citation"><sup><a href="references.html#ref-Bakeman1997" role="doc-biblioref">41</a>,<a href="references.html#ref-Morgan2019" role="doc-biblioref">42</a></sup></span></p>
<p>In order to take these limitations in account, the agreement between reviewers was calculated using
the KappaAcc<span class="citation"><sup><a href="references.html#ref-Bakeman2011" role="doc-biblioref">39</a></sup></span> from Professor Emeritus Roger Bakeman, Georgia State University, which
computes the estimated accuracy of simulated reviewers.</p>
</div>
<div id="raw-data" class="section level3 hasAnchor">
<h3><span class="header-section-number">3.4.2</span> RAW data<a href="materials-and-methods.html#raw-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In order to better understand the data acquisition, it has been acquired a Single Lead Heart Rate
Monitor breakout from Sparkfun™<span class="citation"><sup><a href="references.html#ref-sparkfun2021" role="doc-biblioref">43</a></sup></span> using the AD8232<span class="citation"><sup><a href="references.html#ref-AnalogDevices2020" role="doc-biblioref">44</a></sup></span> microchip
from Analog Devices Inc., compatible with Arduino<sup>®</sup>,<span class="citation"><sup><a href="references.html#ref-arduino2021" role="doc-biblioref">45</a></sup></span> for an in-house experiment
(Fig. <a href="materials-and-methods.html#fig:ad8232">3.5</a>).</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:ad8232"></span>
<img src="/home/runner/work/false.alarm/false.alarm/protocol/figure/sparkfun.jpg" alt="Single Lead Heart Rate Monitor" width="40%" /><img src="/home/runner/work/false.alarm/false.alarm/protocol/figure/FullSetup.jpg" alt="Single Lead Heart Rate Monitor" width="40%" />
<p class="caption">
FIGURE 3.5: Single Lead Heart Rate Monitor
</p>
</div>
<p>The output gives us a RAW signal, as shown in Fig. <a href="materials-and-methods.html#fig:rawsignal">3.6</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:rawsignal"></span>
<img src="/home/runner/work/false.alarm/false.alarm/protocol/figure/arduino_plot.jpg" alt="RAW output from Arduino at ~300hz" width="50%" />
<p class="caption">
FIGURE 3.6: RAW output from Arduino at ~300hz
</p>
</div>
<p>After applying the same settings as the Physionet database (collecting the data at 500hz, resample
to 250hz, pass-filter, and notch filter), the signal is much better, as shown in Fig.
<a href="materials-and-methods.html#fig:filtersignal">3.7</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:filtersignal"></span>
<img src="/home/runner/work/false.alarm/false.alarm/protocol/figure/filtered_ecg.png" alt="Gray is RAW, Red is filtered" width="90%" />
<p class="caption">
FIGURE 3.7: Gray is RAW, Red is filtered
</p>
</div>
</div>
<div id="preparing-the-data" class="section level3 hasAnchor">
<h3><span class="header-section-number">3.4.3</span> Preparing the data<a href="materials-and-methods.html#preparing-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Usually, data obtained by sensors needs to be “cleaned” for proper evaluation. That is different
from the initial filtering process where the purpose is to enhance the signal. Here we are dealing
with artifacts, disconnected cables, wandering baselines and others.</p>
<p>Several SQIs (Signal Quality Indexes) are used in the literature,<span class="citation"><sup><a href="references.html#ref-eerikainen2015" role="doc-biblioref">46</a></sup></span> some trivial
measures as <em>kurtosis</em>, <em>skewness</em>, median local noise level, other more complex as pcaSQI (the
ratio of the sum of the five largest eigenvalues associated with the principal components over the
sum of all eigenvalues obtained by principal component analysis applied to the time aligned ECG
segments in the window). An assessment of several different methods to estimate electrocardiogram
signal quality can was performed by Del Rio, <em>et al</em>.<span class="citation"><sup><a href="references.html#ref-DelRio2011" role="doc-biblioref">47</a></sup></span></p>
<p>By experimentation (yet to be validated), a simple formula gives us the
“complexity” of the signal and correlates well with the noisy data is shown in Equation
<a href="materials-and-methods.html#eq:complex">(3.2)</a>.<span class="citation"><sup><a href="references.html#ref-Batista2014" role="doc-biblioref">48</a></sup></span></p>
<p><br />
<span class="math display" id="eq:complex">\[\begin{equation}
\sqrt{\sum_{i=1}^w((x_{i+1}-x_i)^2)}, \quad \text{where}\; w \; \text{is the window size} \tag{3.2}
\end{equation}\]</span><br />
</p>
<p>The Fig. <a href="materials-and-methods.html#fig:sqi">3.8</a> shows some SQIs and their relation with the data.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:sqi"></span>
<img src="/home/runner/work/false.alarm/false.alarm/protocol/figure/noise.png" alt="Green line is the &quot;complexity&quot; of the signal" width="100%" />
<p class="caption">
FIGURE 3.8: Green line is the “complexity” of the signal
</p>
</div>
<p>Fig. <a href="materials-and-methods.html#fig:datafilter">3.9</a> shows that noisy data (probably patient muscle movements) are marked
with a blue point and thus are ignored by the algorithm.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:datafilter"></span>
<img src="/home/runner/work/false.alarm/false.alarm/protocol/figure/regime_filter.svg" alt="Noisy data marked by the &quot;complexity&quot; filter" width="100%" />
<p class="caption">
FIGURE 3.9: Noisy data marked by the “complexity” filter
</p>
</div>
<p>Although this step of “cleaning” the data is often used, this step will also be tested if it is
really necessary and the performance with and without “cleaning” will be reported.</p>
</div>
<div id="detecting-regime-changes" class="section level3 hasAnchor">
<h3><span class="header-section-number">3.4.4</span> Detecting regime changes<a href="materials-and-methods.html#detecting-regime-changes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The regime change approach will be using the <em>Arc Counts</em> concept, used on the FLUSS (Fast Low-cost
Unipotent Semantic Segmentation) algorithm, as explained by Gharghabi, <em>et al.</em>,<span class="citation"><sup><a href="references.html#ref-gharghabi2018" role="doc-biblioref">49</a></sup></span>.</p>
<p>The FLUSS (and FLOSS, the on-line version) algorithm is built on top of the Matrix Profile
(MP)<span class="citation"><sup><a href="references.html#ref-Yeh2017a" role="doc-biblioref">22</a></sup></span>, described on section <a href="materials-and-methods.html#matrixprofile">3.2.1</a>. Recalling that the MP and the companion
Profile Index (PI) are two vectors holding information about the 1-NN. One can imagine several
“arcs” starting from one “index” to another. This algorithm is based on the assumption that between
two regimes, the most similar shape (its nearest neighbor) is located on “the same side”, so the
number of “arcs” decreases when there is a change on the regime, and increases again. As show on
Fig. <a href="materials-and-methods.html#fig:arcsoriginal">3.10</a>. This drop on the <em>Arc Counts</em> is a signal that a change on the shape
of the signal has happened.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:arcsoriginal"></span>
<img src="/home/runner/work/false.alarm/false.alarm/protocol/figure/fluss_arcs.svg" alt="FLUSS algorithm, using arc counts." width="100%" />
<p class="caption">
FIGURE 3.10: FLUSS algorithm, using arc counts.
</p>
</div>
<p>The choice of the FLOSS algorithm (on-line version of FLUSS) is founded on the following arguments:</p>
<ul>
<li><strong>Domain Agnosticism:</strong> the algorithm makes no assumptions about the data as opposed to most
available algorithms to date.</li>
<li><strong>Streaming:</strong> the algorithm can provide real-time information.</li>
<li><strong>Real-World Data Suitability:</strong> the objective is not to <em>explain</em> all the data. Therefore, areas
marked as “don’t know” areas are acceptable.</li>
<li><strong>FLOSS is not:</strong> a change point detection algorithm.<span class="citation"><sup><a href="references.html#ref-aminikhanghahi2016" role="doc-biblioref">50</a></sup></span> The interest here is
changes in the shapes of a sequence of measurements.</li>
</ul>
<p>Other algorithms we can cite are based on Hidden Markov Models (HMM) that require at least two
parameters to be set by domain experts: cardinality and dimensionality reduction. The most
attractive alternative could be the Autoplait,<span class="citation"><sup><a href="references.html#ref-Matsubara2014" role="doc-biblioref">51</a></sup></span> which is also domain agnostic and
parameter-free. It segments the time series using Minimum Description Length (MDL) and recursively
tests if the region is best modeled by one or two HMM. However, Autoplait is designed for batch
operation, not streaming, and also requires discrete data. FLOSS was demonstrated to be superior in
several datasets in its original paper. In addition, FLOSS is robust to several changes in data like
downsampling, bit depth reduction, baseline wandering, noise, smoothing, and even deleting 3% of the
data and filling with simple interpolation. Finally, the most important, the algorithm is light and
suitable for low-power devices.</p>
<p>In the MP domain, it is worth also mentioning other possible algorithm: the Time Series Snippets,<span class="citation"><sup><a href="references.html#ref-Imani2018" role="doc-biblioref">52</a></sup></span> based on MPdist.<span class="citation"><sup><a href="references.html#ref-gharghabi2018b" role="doc-biblioref">53</a></sup></span> The latter measures the distance between two
sequences considering how many similar sub-sequences they share, no matter the order of matching. It
proved to be a useful measure (not a metric) for meaningfully clustering similar sequences. Time
Series Snippets exploits MPdist properties to summarize a dataset extracting the <span class="math inline">\(k\)</span> sequences that
represent most of the data. The final result seems to be an alternative for detecting regime
changes, but it is not. The purpose of this algorithm is to find which pattern(s) explains most of
the dataset. Also, it is not suitable for streaming data. Lastly, MPdist is quite expensive compared
to the trivial Euclidean distance.</p>
<p>The regime change detection will be evaluated following the criterias explained on section
<a href="materials-and-methods.html#evaluation">3.5</a>.</p>
</div>
<div id="classregime" class="section level3 hasAnchor">
<h3><span class="header-section-number">3.4.5</span> Classification of the new regime<a href="materials-and-methods.html#classregime" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<!--

Chin [10.1109/IEMBS.2010.5628088] uses cross-correlation between templates and the signal to
identify arrhythmias. a light-weight algorithm suitable for short-term real-time ECG analysis which
can be implemented on a mobile device platform will be presented.


Silka [10.1109/CIC.1992.269406] and Caswell [10.1109/CIC.1993.378474], are pioneers in
developing template matching algorithms for ECG analysis. Lai [10.1109/IEMBS.1998.745844] used
fractal and cross-correlation analysis as parameters for a real-time ECG classification algorithm

Bousselijot [10.1109/CIC.1998.731806]: The interpretation of ECGs without feature extraction is
possible using the algorithm of cross correlation for normalized multi-lead waveforms

Schuckers [10.1109/NEBC.1998.664864] compares algorithms


Ruiz [10.1109/CIC.2003.1291259] in 2003 introduced a method to cross-correlate between a reference
signal, which is the first 0.6 sec segment of the examined ECG signal, and a base signal, which is
the rest of the signal.



-->
<p>The next step towards the objective of this work is to verify if the new regime detected by the
previous step is indeed a life-threatening pattern that we should trigger the alarm.</p>
<p>First let’s dismiss some apparent solutions: (1) Clustering. It is well understood that we cannot
cluster time series subsequences meaningfully with any distance measure, or with any algorithm.<span class="citation"><sup><a href="references.html#ref-Keogh2005" role="doc-biblioref">54</a></sup></span> The main argument is that in a meaningfull algorithm, the output depends on the input,
and this has been proven to not happen in time series subsequence clustering.<span class="citation"><sup><a href="references.html#ref-Keogh2005" role="doc-biblioref">54</a></sup></span> (2)
Anomaly detection. In this work we are not looking for surprises, but for patterns that are known to
be life-threatening. (3) Forecasting. We may be tempted to make predictions, but clearly this is not
the idea here.</p>
<p>The method of choice is classification. The simplest algorithm could be a <code>TRUE</code>/<code>FALSE</code> binary
classification. Nevertheless, the five life-threatening patterns have well defined characteristics
that may seem more plausible to classify the new regime using some kind of ensamble of binary
classifiers or a “six-class” classifier (being the sixth class the <code>FALSE</code> class).</p>
<p>Since the model doesn’t know which life-threatening pattern will be present in the regime (or if it
will be a <code>FALSE</code> case), the model will need to check for all five <code>TRUE</code> cases and if none of these
cases are identified, it will classify the regime as <code>FALSE</code>.</p>
<p>In order to avoid exceeding processor capacity, an initial set of shapelets<span class="citation"><sup><a href="references.html#ref-Rakthanmanon2013" role="doc-biblioref">55</a></sup></span> can
be sufficient to build the <code>TRUE</code>/<code>FALSE</code> classifier. And to build such set of shapelets, leveraging
on the MP, we will use the Contrast Profile.<span class="citation"><sup><a href="references.html#ref-Mercer2021" role="doc-biblioref">56</a></sup></span></p>
<p>The Contrast Profile (CP) looks for patterns that are at the same time very <em>similar</em> to its
neighbors in class <em>A</em> while is very <em>different</em> from the nearest neighbor from class <em>B</em>. In other
words, this means that such pattern represents well class <em>A</em> and may be taken as a “signature” of
that class.</p>
<p>In this case we need to compute two MP, one self-join MP using the <em>positive</em> class <span class="math inline">\(MP^{(++)}\)</span> (the
class that has the signature we want to find) and one AB-join MP using the <em>positive</em> and <em>negative</em>
classes <span class="math inline">\(MP^{(+-)}\)</span>. Then we subtract the first <span class="math inline">\(MP^{(++)}\)</span> from the last <span class="math inline">\(MP^{(+-)}\)</span>, resulting in
the <span class="math inline">\(CP\)</span>. The high values on <span class="math inline">\(CP\)</span> are the locations for the signature candidates we look for (the
author of CP calls these segments <em>Plato’s</em>).</p>
<p>Due to the nature of this approach, the MP’s (containing values in Euclidean Distance) are truncated
for values above <span class="math inline">\(\sqrt{2w}\)</span>, where <span class="math inline">\(w\)</span> is the window size. This because values above this threshold
are negatively correlated in the Pearson Correlation space. Finally, we normalize the values by
<span class="math inline">\(\sqrt{2w}\)</span>. The formula <a href="materials-and-methods.html#eq:contrast">(3.3)</a> synthesizes this computation.</p>
<p><br />
<span class="math display" id="eq:contrast">\[\begin{equation}
CP_w = \frac{MP_{w}^{(+-)} - MP_{w}^{(++)}}{\sqrt{2w}} \quad \text{where}\; w \; \text{is the window size} \tag{3.3}
\end{equation}\]</span><br />
</p>
<p>For a more complete understanding of the process, Fig. <a href="materials-and-methods.html#fig:contrast">3.11</a> shows a practical example
from the original article.<span class="citation"><sup><a href="references.html#ref-Mercer2021" role="doc-biblioref">56</a></sup></span></p>
<br />

<div class="figure" style="text-align: center"><span style="display:block;" id="fig:contrast"></span>
<img src="/home/runner/work/false.alarm/false.alarm/protocol/figure/contrast.svg" alt="Top to bottom: two weakly-labeled snippets of a larger time series. T(-) contains only normal beats. T(+) also contains PVC (premature ventricular contractions). Next, two Matrix Profiles with window size 91; AB-join is in red and self-join in blue. Bottom, the Contrast Profile showing the highest location." width="100%" />
<p class="caption">
FIGURE 3.11: Top to bottom: two weakly-labeled snippets of a larger time series. T(-) contains only normal beats. T(+) also contains PVC (premature ventricular contractions). Next, two Matrix Profiles with window size 91; AB-join is in red and self-join in blue. Bottom, the Contrast Profile showing the highest location.
</p>
</div>
<p>After extracting candidates for each class signature, a classification algorithm will be fitted and
evaluated using the criterias explained on section <a href="materials-and-methods.html#evaluation">3.5</a>.</p>
</div>
<div id="summary-of-the-methodology" class="section level3 hasAnchor">
<h3><span class="header-section-number">3.4.6</span> Summary of the methodology<a href="materials-and-methods.html#summary-of-the-methodology" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In order to summarize the steps taken on this thesis to accomplish the main objective, Figs.
<a href="materials-and-methods.html#fig:regimedetection">3.13</a>, <a href="materials-and-methods.html#fig:shapelets">3.14</a> and <a href="materials-and-methods.html#fig:fullmodel">3.15</a> show the overview of the
processes involved.</p>
<p>First let us introduce the concept of Nested Resampling.<span class="citation"><sup><a href="references.html#ref-Bischl2012" role="doc-biblioref">57</a></sup></span> It is known that when
increasing model complexity, overfitting on the training set becomes more likely to happen.<span class="citation"><sup><a href="references.html#ref-Hastie2009" role="doc-biblioref">58</a></sup></span> This is an issue that this work has to countermeasure as there are many steps that
requires parameter tuning, even for algorithms that are almost parameter-free like the MP.</p>
<p>The rule that must be followed is simple: <em>do not</em> evaluate a model on the same resampling split used
to perform its own parameter tuning. Using simple cross-validation, the information about the test
set “leaks” into the evaluation, which leads to overfitting/overtuning, and gives us an optimistic
biased estimative of the performance. Bernd Bischl, 2012<span class="citation"><sup><a href="references.html#ref-Bischl2012" role="doc-biblioref">57</a></sup></span> describes more deeply these
factors, and also gives us a countermeasure for that: (1) from preprocessing the data to model
selection use the training set; (2) the test set should be touched once, on the evaluation step; (3)
repeat. This guarantees that a “new” separated data is only used <em>after</em> the model is trained/tuned.</p>
<p>Fig. <a href="materials-and-methods.html#fig:nestedresampling">3.12</a> shows us this principle. The steps (1) and (2) described above are
part of the <strong>Outer resampling</strong>, which in each loop splits the data in two sets: the training set
and the test set. The training set is then used in the <strong>Inner resampling</strong> where, for example, the
usual cross-validation may be used (creating an <em>Analysis set</em> and an <em>Assessment set</em>, to avoid
conflict of terminology), and the best model/parameters is selected. Then, this best model is
evaluated against the unseen test set that was created for this resampling.</p>
<p>The resulting (aggregated) performance of all outer samples gives us a more honest estimative
of the expected performance on new data.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:nestedresampling"></span>
<img src="/home/runner/work/false.alarm/false.alarm/protocol/figure/draw-nested-resampling.svg" alt="Nested resampling. The full dataset is resampled several times (outer resampling), so each branch has its own Test set (yellow). On each branch, the Training set is used as if it were a full dataset, being resampled again (inner resampling); here the Assessment set (blue) is used to test the learning model and tune parameters. The best model then, is finally evaluated on its own Test set." width="70%" />
<p class="caption">
FIGURE 3.12: Nested resampling. The full dataset is resampled several times (outer resampling), so each branch has its own Test set (yellow). On each branch, the Training set is used as if it were a full dataset, being resampled again (inner resampling); here the Assessment set (blue) is used to test the learning model and tune parameters. The best model then, is finally evaluated on its own Test set.
</p>
</div>
<p><br />
</p>
<p>After the understanding of the Nested Resampling,<span class="citation"><sup><a href="references.html#ref-Bischl2012" role="doc-biblioref">57</a></sup></span> the following flowcharts can be
better interpreted. Fig. <a href="materials-and-methods.html#fig:regimedetection">3.13</a> starts with the “Full Dataset” that contains all
time series from the dataset described on section <a href="materials-and-methods.html#the-data">3.3</a>. Each time series represents one
file from the database, and represents one patient.</p>
<p>The regime change detection will use subsampling (bootstrapping can lead to substantial bias toward
more complex models) in the Outer resampling and cross-validation in the Inner resampling. How
the evaluation will be performed and why the use of cross-validation will be explained on section
<a href="materials-and-methods.html#evaluation">3.5</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:regimedetection"></span>
<img src="/home/runner/work/false.alarm/false.alarm/protocol/figure/draw-regime-model.svg" alt="Pipeline for regime change detection. The full dataset (containing several patients) is divided on a Training set and a Test set. The Training set is then resampled in an Analysis set and an Assessment set. The former is used for training/parameter tuning and the latter for assessing the result. The best parameters are then used for evaluation on the Test set. This may be repeated several times." width="90%" />
<p class="caption">
FIGURE 3.13: Pipeline for regime change detection. The full dataset (containing several patients) is divided on a Training set and a Test set. The Training set is then resampled in an Analysis set and an Assessment set. The former is used for training/parameter tuning and the latter for assessing the result. The best parameters are then used for evaluation on the Test set. This may be repeated several times.
</p>
</div>
<p>Fig. <a href="materials-and-methods.html#fig:shapelets">3.14</a> shows the processes for training the classification model. First, the last
ten seconds of each time series will be identified (the even occurs in this segment). Then the
dataset will be grouped by class (type of event) and <code>TRUE</code>/<code>FALSE</code> (alarm), so the Outer/Inner
resampling will produce a Training/Analysis set and Test/Assessment set with similar frequency of
the full dataset.</p>
<p>The next step will be to extract shapelet candidates using the Contrast Profile and train the
classifier.</p>
<p>This pipeline will use subsampling (for the same reason above) in the Outer resampling and
cross-validation in the Inner resampling. How the evaluation will be performed and why the use of
cross-validation will be explained on section <a href="materials-and-methods.html#evaluation">3.5</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:shapelets"></span>
<img src="/home/runner/work/false.alarm/false.alarm/protocol/figure/draw-classif-model.svg" alt="Pipeline for alarm classification. The full dataset (containing several patients) is grouped by class and by TRUE/FALSE alarm. This grouping allows resampling to keep a similar frequency of classes and TRUE/FALSE of the full dataset. Then the full dataset is divided on a Training set and a Test set. The Training set is then resampled in an Analysis set and an Assessment set. The former is used for extracting shapelets, training the model and parameter tuning; the latter for assessing the performance of the model. Finally, the best model is evaluated on the Test set. This may be repeated several times." width="60%" />
<p class="caption">
FIGURE 3.14: Pipeline for alarm classification. The full dataset (containing several patients) is grouped by class and by TRUE/FALSE alarm. This grouping allows resampling to keep a similar frequency of classes and TRUE/FALSE of the full dataset. Then the full dataset is divided on a Training set and a Test set. The Training set is then resampled in an Analysis set and an Assessment set. The former is used for extracting shapelets, training the model and parameter tuning; the latter for assessing the performance of the model. Finally, the best model is evaluated on the Test set. This may be repeated several times.
</p>
</div>
<p>Finally, Fig. <a href="materials-and-methods.html#fig:fullmodel">3.15</a> shows how the final model will be used on the field. In a
streaming scenario, the data will be collected and processed in real-time to maintain an up to date
Matrix Profile. The FLOSS algorithm will be looking for a regime change. When a regime change is
detected, a sample of this new regime will be presented to the trained classifier that will evaluate
if this new regime is a life-threatening condition or not.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fullmodel"></span>
<img src="/home/runner/work/false.alarm/false.alarm/protocol/figure/draw-global-model.svg" alt="Pipeline of the final process. The streaming data, coming from one patient, is processed to create its Matrix Profile. Then, the FLOSS algorithm is computed for detecting a regime change. When a new regime is detected, a sample of this new regime is analysed by the model and a decision is made. If the new regime is life-threatening, the alarm will be fired." width="60%" />
<p class="caption">
FIGURE 3.15: Pipeline of the final process. The streaming data, coming from one patient, is processed to create its Matrix Profile. Then, the FLOSS algorithm is computed for detecting a regime change. When a new regime is detected, a sample of this new regime is analysed by the model and a decision is made. If the new regime is life-threatening, the alarm will be fired.
</p>
</div>
</div>
</div>
<div id="evaluation" class="section level2 hasAnchor">
<h2><span class="header-section-number">3.5</span> Evaluation of the algorithms<a href="materials-and-methods.html#evaluation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The subsampling method used on both algorithms, regime change and classification, will be
the Cross Validation, as the learning task will be in batches.</p>
<p>Other options dismissed:<span class="citation"><sup><a href="references.html#ref-Bischl2012" role="doc-biblioref">57</a></sup></span></p>
<ul>
<li><p>Leave-One-Out Cross Validation: has better properties for regression than for classification. It
has a high variance as an estimator of the mean loss. It also is asymptotically inconsistent and
tends to select too complex models. It is demonstrates empirically that 10-fold CV is often
superior.</p></li>
<li><p>Bootstrapping: while it has low variance, it may be optimistic biased on more complex models.
Also, its resampling method with replacement can leak information into the assessment set.</p></li>
<li><p>Subsampling: is like bootstrapping, but without replacement. The only argument for not choosing
it, is that with Cross Validation we make sure all the data is used for analysis and assessment.</p></li>
</ul>
<div id="regime-change" class="section level3 hasAnchor">
<h3><span class="header-section-number">3.5.1</span> Regime change<a href="materials-and-methods.html#regime-change" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A detailed discussion about the evaluation process of segmentation algorithms is made by the
FLUSS/FLOSS author.<span class="citation"><sup><a href="references.html#ref-gharghabi2018" role="doc-biblioref">49</a></sup></span> Previous researches have used precision/recall or derived
measures for performance. The main issue is how to assume that the algorithm was correct? If the
ground truth says the change occurred at location 10,000, and the algorithm detects a change at
location 10,001, is this a miss?</p>
<p>As pointed out by the author, several independent researchers have suggested a temporal tolerance,
that solves one issue, but also has a hard time on penalize any tiny miss beyond this tolerance.</p>
<p>The second issue is a over-penalization of an algorithm in which most of the detections are
good, but just one (or a few) is poor.</p>
<p>The author proposes the solution depicted in Fig. <a href="materials-and-methods.html#fig:flosseval">3.16</a>. It gives 0 as the best score
and 1 as the worst. The function sums the distances between the ground truth locations and the
locations suggested by the algorithm. The sum is then divided by
<!--the product of the number of segments, and then -->
the length of the time series to normalize the range to [0, 1].</p>
<p>The goal is minimizing this score.</p>
<!--
TODO: review the problem when there are too many detections
-->
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:flosseval"></span>
<img src="/home/runner/work/false.alarm/false.alarm/protocol/figure/floss_eval.svg" alt="Regime change evaluation. The top line illustrates the ground truth, and the bottom line the locations reported by the algorithm. Note that multiple proposed locations can be mapped to a single ground truth point." width="100%" />
<p class="caption">
FIGURE 3.16: Regime change evaluation. The top line illustrates the ground truth, and the bottom line the locations reported by the algorithm. Note that multiple proposed locations can be mapped to a single ground truth point.
</p>
</div>
</div>
<div id="classification" class="section level3 hasAnchor">
<h3><span class="header-section-number">3.5.2</span> Classification<a href="materials-and-methods.html#classification" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As described on section <a href="materials-and-methods.html#classregime">3.4.5</a>, the model for classification will use a set of shapelets
to identify if we have a <code>TRUE</code> (life-threatening) regime or a <code>FALSE</code> (non life-threatening) regime.</p>
<p>Although the implementation of the final process will be using streaming data, the classification
algorithm will work in batches, because it will not be applied on every single data point, but on
samples that are extracted when a regime change is detected. During the training phase, the data is
also analyzed in batches.</p>
<p>One important factor we must consider is that, on real world, the majority of regime changes will be
<code>FALSE</code> (i.e., not life-threatening). Thus, a performance measure that is robust to class imbalance
is needed if we want to be able to assess the model after it was trained, on the field.</p>
<p>It is well known that the <em>Accuracy</em> measure is not reliable for unbalanced data<span class="citation"><sup><a href="references.html#ref-Akosa2017" role="doc-biblioref">37</a>,<a href="references.html#ref-Bekkar2013" role="doc-biblioref">59</a></sup></span> as it returns optimistic results for a classifier on the majority class. A
description of common measures used on classification is available.<span class="citation"><sup><a href="references.html#ref-Akosa2017" role="doc-biblioref">37</a>,<a href="references.html#ref-Chicco2020" role="doc-biblioref">60</a></sup></span> Here
we will focus on three candidate measures that can be used: F-score (well discussed on<span class="citation"><sup><a href="references.html#ref-Chicco2020" role="doc-biblioref">60</a></sup></span>), Matthew’s Correlation Coefficient (MCC)<span class="citation"><sup><a href="references.html#ref-Matthews1975" role="doc-biblioref">61</a></sup></span> and <span class="math inline">\(\kappa_m\)</span> statistic.<span class="citation"><sup><a href="references.html#ref-Bifet2015" role="doc-biblioref">62</a></sup></span></p>
<p>The F-score (let’s abbreviate to F<sub>1</sub> as this is the more common setting), is widely used on
<em>information retrieval</em>, where the classes are usually classified as “relevant” and “irrelevant”,
and combines the <em>recall</em> (also known as sensitivity) and the <em>precision</em> (the positive predicted
value). <em>Recall</em> assess how well the algorithm retrieves relevant examples among the (usually few)
relevant items in dataset, while <em>precision</em> assess the proportion of indeed relevant items are
contained in the retrieved examples. It ranges from [0, 1]. It ignores completely the irrelevant
items that were not retrieved (usually this set contain lots of items). In classification tasks, its
main weakness is not evaluate the True Negatives, and if the proportion of a random classifier gets
towards the <code>TRUE</code> class (increasing the False Positives significantly), this score actually gets
better, thus not suitable to our case. The F<sub>1</sub> score is defined on equation <a href="materials-and-methods.html#eq:fscore">(3.4)</a>.</p>
<p><span class="math display" id="eq:fscore">\[\begin{equation}
F_1 score = \frac{2 \cdot TP}{2 \cdot TP + FP + FN} = 2 \cdot \frac{precision \cdot recall}{precision + recall} \tag{3.4}
\end{equation}\]</span></p>
<p>The MCC is a good alternative to the F<sub>1</sub> when we do care about the True negatives (both were
considered to “provide more realistic estimates of real-world model performance”<span class="citation"><sup><a href="references.html#ref-Dubey2018" role="doc-biblioref">63</a></sup></span>). It
is a method to compute the <em>Pearson product-moment correlation coefficient</em><span class="citation"><sup><a href="references.html#ref-Delgado2019" role="doc-biblioref">64</a></sup></span> between
the actual and predicted values. It ranges from [-1, 1]. The MCC is the only binary classification
rate that only gives a high score if the binary classifier was able to correctly classify the
majority of the positive and negative instances.<span class="citation"><sup><a href="references.html#ref-Chicco2020" role="doc-biblioref">60</a></sup></span> One may argue that Cohen’s <span class="math inline">\(\kappa\)</span>
has the same behavior, but there are two main differences (1) MCC is <em>undefined</em> in the case of a
<em>majority voter</em> while Cohen’s <span class="math inline">\(\kappa\)</span> doesn’t discriminates this case from the random classifier
(<span class="math inline">\(\kappa\)</span> is zero for both cases) (2) It is proven that in an special case when the classifier is
increasing the False Negatives, Cohen’s <span class="math inline">\(\kappa\)</span> doesn’t get worse as spected, MCC
doesn’t have this issue.<span class="citation"><sup><a href="references.html#ref-Delgado2019" role="doc-biblioref">64</a></sup></span> MCC is defined on equation <a href="materials-and-methods.html#eq:mccval">(3.5)</a>.</p>
<p><span class="math display" id="eq:mccval">\[\begin{equation}
MCC = \frac{TP \cdot TN - FP \cdot FN}{\sqrt{(TP + FP) \cdot (TP + FN) \cdot (TN + FP) \cdot (TN + FN)}} \tag{3.5}
\end{equation}\]</span></p>
<p>The <span class="math inline">\(\kappa_m\)</span> statistic<span class="citation"><sup><a href="references.html#ref-Bifet2015" role="doc-biblioref">62</a></sup></span> is a measure that takes in account not the <em>random classifier</em>
but the <em>majority voter</em> (a classifier that only votes on the larger class). It was introduced by
Bifet <em>et al.</em><span class="citation"><sup><a href="references.html#ref-Bifet2015" role="doc-biblioref">62</a></sup></span> for being used in online settings, where the class balance may change
over time. It is defined on equation <a href="materials-and-methods.html#eq:kappam">(3.6)</a>, where <span class="math inline">\(p_0\)</span> is the observed accuracy and
<span class="math inline">\(p_m\)</span> is the accuracy of the majority voter. The score ranges from (<span class="math inline">\(-\infty\)</span>, 1], theoretically,
but in practice you see negative numbers if the classifier is performing worse than the majority voter
and positive numbers if performing better than the majority number, until the maximum of 1, when the
classifier is optimal.</p>
<p><span class="math display" id="eq:kappam">\[\begin{equation}
\kappa_m = \frac{p_0 - p_m}{1 - p_m} \tag{3.6}
\end{equation}\]</span></p>
<p>In the inner resampling (model training/tuning), the classification will be binary, and in our case
we know that the data is slightly unbalanced (60% false alarms). For this step, the metric for model
selection will be the MCC. Nevertheless, during the optimization process, the algorithm will seek to
minimize the False Negative Rate (<span class="math inline">\(FNR = \frac{FN}{TP+FN}\)</span>), and between ties, the smaller FNR wins.</p>
<p>In the outer resampling, the MCC and <span class="math inline">\(\kappa_m\)</span> of all winning models will aggregated and reported
using the median and interquartile range.</p>
<p>For different classifiers, we will use the Wilcoxon’s signed-rank test for comparing their performances,
as this method is known to have low Type I and Type II errors in this kind of comparison.<span class="citation"><sup><a href="references.html#ref-Bifet2015" role="doc-biblioref">62</a></sup></span></p>
</div>
<div id="full-model-streaming-setting" class="section level3 hasAnchor">
<h3><span class="header-section-number">3.5.3</span> Full model (streaming setting)<a href="materials-and-methods.html#full-model-streaming-setting" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For the final assessment, the best and the average model of the previous pipelines will be assembled
and tested using the whole original dataset.</p>
<p>The algorithm will be tested in each of the five life-threatening event split individually, in order
to evaluate its strengths and weakness.</p>
<p>For more transparency, the whole confusion matrix will be reported, as well as the MCC, <span class="math inline">\(\kappa_m\)</span>, and
the FLOSS evaluation.</p>

<!--
This is for including Chapter 1. Notice that it's also good practice to name your chunk. This will
help you debug potential issues as you knit. The chunk above is called intro and the one below is
called chapter1. Feel free to change the name of the Rmd file as you wish, but don't forget to
change it here from chap1.Rmd.
-->
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="principles.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="current-results.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "github", "whatsapp", "instapaper", "weibo", "vk"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": [["thesis.pdf", "PDF"], ["thesis.epub", "EPUB"], ["thesis.docx", "Word"]],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "none",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
