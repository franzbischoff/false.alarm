{
  // See https://go.microsoft.com/fwlink/?LinkId=733558
  // for the documentation about the tasks.json format
  "version": "2.0.0",
  "tasks": [
    {
      "type": "shell",
      "label": "R: misc: ASAN/USBAN",
      "command": "echo 'MingW does not support ASAN/UBSAN'",
      "linux": {
        "type": "process",
        "command": "/bin/Rscript",
        "args": [
          "dev/check_asan.R"
        ]
      },
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "group": "test",
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true
      },
      "problemMatcher": [
        {
          "owner": "R",
          "fileLocation": [
            "relative",
            "${workspaceFolder}/src"
          ],
          "pattern": {
            "regexp": "^\\**(.*):(\\d+):(\\d+):\\s+runtime (warning|error):\\s+(.*)$",
            "file": 1,
            "line": 2,
            "column": 3,
            "severity": 4,
            "message": 5
          }
        },
        {
          "owner": "R",
          "severity": "warning",
          "pattern": [
            {
              "kind": "file",
              "regexp": ".*(NOTE|WARNING)",
              "file": 1
            },
            {
              "regexp": "(.*)",
              "message": 1
            }
          ]
        },
        {
          "owner": "R",
          "severity": "error",
          "pattern": [
            {
              "kind": "file",
              "regexp": ".*(ERROR)",
              "file": 1
            },
            {
              "regexp": "(.*)",
              "message": 1
            }
          ]
        }
      ]
    },
    {
      "type": "process",
      "label": "R: misc: knit and view",
      "command": "C:/Program Files/R/R-4.2.0/bin/x64/Rscript.exe",
      "linux": {
        "command": "/bin/Rscript"
      },
      "args": [
        "-e",
        "if(Sys.time() - ifelse(file.exists(r'(${fileDirname}/${fileBasenameNoExtension}.pdf)'), file.mtime(r'(${fileDirname}/${fileBasenameNoExtension}.pdf)'), Sys.time() - 510) > 500) {rmarkdown::render(r'(${file})', encoding = 'UTF-8')}"
      ],
      "options": {
        "cwd": "${fileDirname}"
      },
      "presentation": {
        "clear": false,
        "focus": false,
        "group": "R",
        "panel": "shared",
        "reveal": "silent"
      },
      "runOptions": {
        "instanceLimit": 1
      },
      "problemMatcher": []
    },
    {
      "type": "process",
      "label": "R: routine: Style project",
      "command": "C:/Program Files/R/R-4.2.0/bin/x64/Rscript.exe",
      "linux": {
        "command": "/bin/Rscript"
      },
      "args": [
        "-e",
        "styler:::style_dir(filetype = c('R', 'Rmd'), recursive = TRUE, exclude_files = 'R/RcppExports.R', exclude_dirs = c('docs', 'dev', 'renv', '.history'))"
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "presentation": {
        "clear": true,
        "reveal": "always",
        "group": "R",
        "panel": "shared"
      },
      "problemMatcher": []
    },
    {
      "type": "process",
      "label": "R: targets: gittargets",
      "command": "C:/Program Files/R/R-4.2.0/bin/x64/Rscript.exe",
      "linux": {
        "command": "/bin/Rscript"
      },
      "args": [
        "dev/gittargets.R"
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "presentation": {
        "clear": true,
        "reveal": "always",
        "group": "R",
        "panel": "shared"
      },
      "problemMatcher": []
    },
    {
      "type": "process",
      "label": "R: routine: Update codemeta",
      "command": "C:/Program Files/R/R-4.2.0/bin/x64/Rscript.exe",
      "linux": {
        "command": "/bin/Rscript"
      },
      "args": [
        "-e",
        "codemetar::write_codemeta(use_filesize=TRUE, write_minimeta=TRUE, verbose=TRUE); codemetar::give_opinions()"
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "group": "none",
      "presentation": {
        "clear": true,
        "group": "R",
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": []
    },
    {
      "type": "process",
      "label": "R: routine: Update docs and self install",
      "command": "C:/Program Files/R/R-4.2.0/bin/x64/Rscript.exe",
      "linux": {
        "command": "/bin/Rscript"
      },
      "args": [
        "-e",
        "devtools::check_man(); renv::install('.')"
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "group": "none",
      "presentation": {
        "clear": true,
        "group": "R",
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": [
        {
          "owner": "R",
          "severity": "warning",
          "fileLocation": [
            "relative",
            "${workspaceFolder}/R"
          ],
          "pattern": [
            {
              "kind": "file",
              "regexp": "^(Undocumented.*)\\s+in.*object\\s+'(.*)'$",
              "message": 1,
              "file": 2
            },
            {
              "regexp": "(.*)",
              "message": 1
            }
          ]
        },
      ]
    },
    {
      "type": "process",
      "label": "R: routine: Lint project",
      "command": "C:/Program Files/R/R-4.2.0/bin/x64/Rscript.exe",
      "linux": {
        "command": "/bin/Rscript"
      },
      "args": [
        "-e",
        "library(lintr); for (i in c('analysis', 'R', 'scripts', 'review', 'thesis', 'output')) {print(lint_dir(path = i, linters = linters_with_defaults(brace_linter, T_and_F_symbol_linter, assignment_linter, commas_linter, commented_code_linter = NULL, cyclocomp_linter(50), object_name_linter(styles = 'snake_case'), object_length_linter(30), equals_na_linter, function_left_parentheses_linter, infix_spaces_linter, line_length_linter(500), no_tab_linter, object_usage_linter = NULL, absolute_path_linter(lax = TRUE), nonportable_path_linter = NULL, pipe_continuation_linter, semicolon_linter(allow_compound = TRUE), seq_linter, single_quotes_linter, spaces_inside_linter, spaces_left_parentheses_linter, trailing_blank_lines_linter, trailing_whitespace_linter, undesirable_function_linter, undesirable_operator_linter, unneeded_concatenation_linter), exclusions = list('R/RcppExports.R')))}"
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "group": "none",
      "presentation": {
        "clear": true,
        "group": "R",
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": [
        "$gcc"
      ]
    },
    {
      "type": "process",
      "label": "R: routine: Test units",
      "command": "C:/Program Files/R/R-4.2.0/bin/x64/Rscript.exe",
      "linux": {
        "command": "/bin/Rscript"
      },
      "args": [
        "-e",
        "testthat::test_local()"
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "group": {
        "kind": "test",
        "isDefault": true
      },
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true
      },
      "problemMatcher": []
    },
    {
      "type": "process",
      "label": "R: routine: Update renv and isolate",
      "command": "C:/Program Files/R/R-4.2.0/bin/x64/Rscript.exe",
      "linux": {
        "command": "/bin/Rscript"
      },
      "args": [
        "-e",
        "renv::update(prompt=FALSE); renv::isolate()"
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "group": {
        "kind": "test",
        "isDefault": true
      },
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true
      },
      "problemMatcher": []
    },
    {
      "type": "process",
      "label": "R: misc: test coverage",
      "dependsOn": "R: routine: test units",
      "command": "C:/Program Files/R/R-4.2.0/bin/x64/Rscript.exe",
      "linux": {
        "command": "/bin/Rscript"
      },
      "args": [
        "-e",
        "covr::package_coverage()"
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "group": "test",
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true
      },
      "problemMatcher": []
    },
    {
      "type": "process",
      "label": "R: targets: Start watch page",
      "command": "C:/Program Files/R/R-4.2.0/bin/x64/Rscript.exe",
      "linux": {
        "command": "/bin/Rscript"
      },
      "args": [
        "-e",
        "targets::tar_watch(targets_only = TRUE, exclude = c('.Random.seed', 'var_window_size', 'var_time_constraint'),  seconds = 30, display = 'graph', browse = FALSE, outdated = FALSE, label = c('time', 'branches', 'size'), port = 55444); Sys.sleep(Inf)"
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "group": "test",
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true
      },
      "problemMatcher": []
    },
    {
      "type": "process",
      "label": "R: targets: zDESTROY targets",
      "command": "C:/Program Files/R/R-4.2.0/bin/x64/Rscript.exe",
      "linux": {
        "command": "/bin/Rscript"
      },
      "args": [
        "-e",
        "targets::tar_destroy()"
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "group": {
        "kind": "test",
        "isDefault": true
      },
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true
      },
      "problemMatcher": []
    },
    {
      "type": "process",
      "label": "R: targets: zPRUNE targets",
      "command": "C:/Program Files/R/R-4.2.0/bin/x64/Rscript.exe",
      "linux": {
        "command": "/bin/Rscript"
      },
      "args": [
        "-e",
        "targets::tar_prune()"
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "group": {
        "kind": "test",
        "isDefault": true
      },
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true
      },
      "problemMatcher": []
    },
    {
      "type": "process",
      "label": "R: targets: zPROFILE targets",
      "command": "C:/Program Files/R/R-4.2.0/bin/x64/Rscript.exe",
      "linux": {
        "command": "/bin/Rscript"
      },
      "args": [
        "-e",
        "proffer::record_pprof(targets::tar_make(callr_function = NULL), pprof = 'Pprof.out')"
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "group": {
        "kind": "test",
        "isDefault": true
      },
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true
      },
      "problemMatcher": []
    },
    {
      "type": "shell",
      "label": "Cpp: build current file",
      "command": "C:/rtools40/${input:compiler}/bin/g++.exe",
      "linux": {
        "command": "/usr/bin/g++"
      },
      "osx": {
        "command": "/usr/bin/clang++"
      },
      "detail": "compiler: g++/clang++",
      "args": [
        "-std=gnu++11",
        "-DNDEBUG",
        "-I\"/usr/share/R/include\"",
        "-I\"${workspaceFolder}/renv/library/R-4.1/${input:renv_arch}/Rcpp/include\"",
        "-I\"${workspaceFolder}/renv/library/R-4.1/${input:renv_arch}/RcppParallel/include\"",
        "-I\"${workspaceFolder}/renv/library/R-4.1/${input:renv_arch}/RcppProgress/include\"",
        "-I\"${workspaceFolder}/renv/library/R-4.1/${input:renv_arch}/RcppThread/include\"",
        "-DRCPP_PARALLEL_USE_TBB=1",
        "-DSTRICT_R_HEADERS",
        "-fpic",
        "-g",
        "-O2",
        "-fstack-protector-strong",
        "-Wall",
        "-D_FORTIFY_SOURCE=2",
        // "-mfpmath=sse",
        // "-msse2",
        // "-mstackrealign",
        "-fdiagnostics-color=always",
        "-c",
        "${fileBasename}",
        "-o",
        "${fileBasenameNoExtension}.o"
      ],
      "options": {
        "cwd": "${workspaceFolder}/src"
      },
      "problemMatcher": [
        "$gcc"
      ],
      "group": {
        "kind": "build",
        "isDefault": true
      }
    },
    {
      // config file is stored on ./index/_bookdown.yml
      "type": "process",
      "label": "R: workflowr: Render thesisdown",
      "command": "C:/Program Files/R/R-4.2.0/bin/x64/Rscript.exe",
      "linux": {
        "command": "/bin/Rscript"
      },
      "args": [
        "-e",
        "bookdown::render_book('thesis')"
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "group": {
        "kind": "test",
        "isDefault": true
      },
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true
      },
      "problemMatcher": []
    },
    {
      "type": "process",
      "label": "R: workflowr: Live-preview thesisdown",
      "command": "C:/Program Files/R/R-4.2.0/bin/x64/Rscript.exe",
      "linux": {
        "command": "/bin/Rscript"
      },
      "args": [
        "-e",
        "bookdown::serve_book('thesis')" // servr::daemon_stop(1)
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "group": {
        "kind": "test",
        "isDefault": true
      },
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true
      },
      "problemMatcher": []
    },
    {
      "type": "process",
      "label": "R: workflowr: Live-preview workflowr",
      "command": "C:/Program Files/R/R-4.2.0/bin/x64/Rscript.exe",
      "linux": {
        "command": "/bin/Rscript"
      },
      "args": [
        "-e",
        "app <- servr::httw('docs', browser = TRUE, verbose = TRUE)" // servr::daemon_stop(1)
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "group": {
        "kind": "test",
        "isDefault": true
      },
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true
      },
      "problemMatcher": []
    },
    {
      // config file is stored on ./analysis/_site.yml
      "type": "process",
      "label": "R: workflowr: Pre-build workflowr", // Used while editing. Only project .Rprofile is used.
      "command": "C:/Program Files/R/R-4.2.0/bin/x64/Rscript.exe",
      "linux": {
        "command": "/bin/Rscript"
      },
      "args": [
        "-e",
        "workflowr::wflow_build(make = TRUE, update = TRUE, verbose = TRUE)"
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true
      },
      "problemMatcher": []
    },
    {
      "type": "process",
      "label": "R: targets: Run main pipeline",
      "command": "C:/Program Files/R/R-4.2.0/bin/x64/Rscript.exe",
      "linux": {
        "command": "/bin/Rscript"
      },
      "args": [
        "-e",
        "targets::tar_make_future(reporter = 'summary', script = 'scripts/_targets.R', store = '_targets')"
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "group": {
        "kind": "test",
        "isDefault": true
      },
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true
      },
      "problemMatcher": []
    },
    {
      "type": "process",
      "label": "R: targets: Run classifier pipeline",
      "command": "C:/Program Files/R/R-4.2.0/bin/x64/Rscript.exe",
      "linux": {
        "command": "/bin/Rscript"
      },
      "args": [
        "-e",
        "targets::tar_make_future(reporter = 'summary', script = 'scripts/_classifier.R', store = '_classifier')"
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "group": {
        "kind": "test",
        "isDefault": true
      },
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true
      },
      "problemMatcher": []
    },
    {
      "type": "process",
      "label": "R: targets: Run regime pipeline",
      "command": "C:/Program Files/R/R-4.2.0/bin/x64/Rscript.exe",
      "linux": {
        "command": "/bin/Rscript"
      },
      "args": [
        "-e",
        "targets::tar_make_future(reporter = 'summary', script = 'scripts/_regime_change.R', store = '_regime_change')"
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "group": {
        "kind": "test",
        "isDefault": true
      },
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true
      },
      "problemMatcher": []
    }
  ],
  "inputs": [
    {
      "id": "renv_arch",
      "type": "command",
      "command": "cpptools.activeConfigCustomVariable",
      "args": "renv_arch"
    },
    {
      "id": "compiler",
      "type": "command",
      "command": "cpptools.activeConfigCustomVariable",
      "args": "compiler"
    }
  ]
}
